<!DOCTYPE html>
<html>

<head>
  <title>Web Picto</title>
  <link type="text/css" rel="stylesheet" href="/webjars/bootstrap/css/bootstrap.min.css">
  <link type="text/css" rel="stylesheet" href="css/goldenlayout-base.css" />
  <link type="text/css" rel="stylesheet" href="css/goldenlayout-dark-theme.css" />
  <link type="text/css" rel="stylesheet" href="main.css">
  <link type="text/css" rel="stylesheet" href="dist/themes/default/style.css">
  <script type="text/javascript" src="/webjars/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/webjars/sockjs-client/sockjs.min.js"></script>
  <script type="text/javascript" src="/webjars/stomp-websocket/stomp.min.js"></script>
  <script type="text/javascript" src="js/goldenlayout.js"></script>
  <script type="text/javascript" src="js/ace.js" charset="utf-8"></script>
  <script type="text/javascript" src="/app.js"></script>
  <script type="text/javascript" src="dist/jstree.js"></script>

</head>

<body>
  <script type="text/javascript">

    /*** GOLDEN LAYOUT ***/
    var config = {
      content: [{
        type: 'row',
        content: [{
          type: 'component',
          componentName: 'Visualization',
          componentState: {
            label: 'A'
          }
        }, {
          type: 'column',
          content: [{
            type: 'component',
            componentName: 'Code',
            componentState: {
              label: 'B'
            }
          }, {
            type: 'component',
            componentName: 'Tree',
            componentState: {
              label: 'C'
            }
          }]
        }]
      }]
    };

    var myLayout = new GoldenLayout(config);

    myLayout.registerComponent('Visualization', function (container,
      componentState) {
      container.getElement()
        //.html('<svg id="visualization" class="visualization" width="900" height="600" role="img" xmlns="http://www.w3.org/2000/svg"></svg>');
        .html('<div id="visualization" class="visualization"></div>');
    });

    myLayout.registerComponent('Code', function (container, componentState) {
      var x = container.getElement()
        .html('<div id="editor" class="editor"></div>')
    });

    myLayout.registerComponent('Tree', function (container, componentState) {
      container.getElement()
        .html('<input type="text" id="searchText" name="searchText"></input>' +
          '<div id="tree" class="tree">A</div>');
    });


    /// Callback for every created stack
    myLayout.on('stackCreated', function (stack) {

      var executeButton = document.createElement("div");
      executeButton.setAttribute("id", "executeButton");
      executeButton.setAttribute("class", "executeButton");
      executeButton.setAttribute("onclick", "executeCode()");

      stack.header.controlsContainer.prepend(executeButton);

    });

    myLayout.on('initialised', function (stack) {

      /*** ACE Editor ***/
      editor = ace.edit("editor");
      editor.setTheme("ace/theme/eclipse");
      editor.session.setMode("ace/mode/xml");
      editor.setFontSize("1rem");
      editor.setOptions({
        fontSize: "11pt"
        , useSoftTabs: true
      });
      editor.setValue('<?nsuri socialnetwork?>\n' +
        '<?render-egx picto/socialnetwork.egx?>\n' +
        '<socialnetwork>\n' +
        '  <person name="Alice" likes="Bob, Charlie"/>\n' +
        '  <person name="Bob" likes="Enid, Alice" dislikes="Fred, Charlie"/>\n' +
        '  <person name="Charlie" likes="Fred, Alice" dislikes="Dawn, Enid"/>\n' +
        '  <person name="Dawn" likes="Bob" dislikes="Fred"/>\n' +
        '  <person name="Enid" likes="Charlie" dislikes="Alice"/>\n' +
        '  <person name="Fred" dislikes="Bob" likes="Enid, Alice"/>\n' +
        '</socialnetwork>');

      //editor.getSession().on('change', function() {
      //updateFlexmiEditorSyntaxHighlighting(flexmiEditor);
      //});

      $('#tree').jstree({
        'core': {
          'data': [
            {
              "text": "Root node", "children": [
                {"text": "Child node 1"},
                {"text": "Child node 2"}
              ]
            }
          ]
        },
        'plugins': ['search']
      });

      var to = false;
      $('#searchText').keyup(function () {
        if (to) {clearTimeout(to);}
        to = setTimeout(function () {
          var v = $('#searchText').val();
          console.log(v);
          $('#tree').jstree(true).search(v, false, true);
        }, 250);
      });


    });
    myLayout.init();
  </script>
</body>

</html>